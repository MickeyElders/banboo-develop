# Runtime configuration for bamboo_vision.py

camera:
  # CSI default; override with a full GStreamer pipeline if needed.
  pipeline: "csi://0"
  width: 1280
  height: 720

model:
  onnx: "models/best_static.onnx"
  engine: "models/best_static.engine"   # optional; leave blank to build on first run
  labels: "config/labels.txt"           # optional labels.txt
  threshold: 0.50
  nms: 0.45
  input_shape: "1x3x960x960"            # fixed shape profile to avoid dynamic issues
  workspace_mb: 2048                    # TensorRT workspace (MiB)
  input_blob: "images"                  # YOLOv8 default
  output_bbox: "output0"                # YOLOv8 default output

calibration:
  pixel_to_mm: 1.0      # placeholder; replace after calibration
  offset_mm: 0.0
  latency_ms: 0.0
  belt_speed_mm_s: 0.0

modbus:
  # If you know the PLC IP, fill host. If empty and auto_discover=true, the code will scan scan_subnet for port 502.
  host: ""
  port: 502
  slave_id: 1
  poll_ms: 50
  write_heartbeat_ms: 20
  auto_discover: true
  scan_subnet: "192.168.1.0/24"   # adjust to the direct-link subnet
  scan_timeout_ms: 75             # TCP connect timeout per host during scan
  addr_cam_to_plc:
    comm: 0x07D0    # D2000
    status: 0x07D1  # D2001
    coord: 0x07D2   # D2002 (float hi/lo)
    result: 0x07D4  # D2004
  addr_plc_to_cam:
    heartbeat: 0x0834  # D2100
    state: 0x0835      # D2101 (1=ready for coordinate; 2=feeding)
    servo_pos: 0x0836  # D2102 (float hi/lo)

output:
  hdmi: false             # HDMI 本地预览（官方 videoOutput）
  webrtc: false           # 暂停 WebRTC，改用软件 RTSP
  webrtc_uri: "webrtc://@:9000/live"
  rtsp: true              # 启用 RTSP
  rtsp_uri: "rtsp://@:8554/live"
  software_rtsp: true     # 使用 x264 软件编码（兼容无 NVENC）

app:
  publish_interval_ms: 100

http:
  enable: true
  host: "0.0.0.0"
  port: 8080
