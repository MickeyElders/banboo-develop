# æ™ºèƒ½åˆ‡ç«¹æœºç³»ç»Ÿ v2.0 - C++/Flutteré‡æ„ç‰ˆ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æ™ºèƒ½åˆ‡ç«¹æœºç³»ç»Ÿv2.0æ˜¯åŸºäºC++åç«¯å’ŒFlutterå‰ç«¯çš„å…¨æ–°æ¶æ„é‡æ„ç‰ˆæœ¬ï¼Œä¸“ä¸ºå·¥ä¸šç¯å¢ƒè®¾è®¡ï¼Œæ”¯æŒåµŒå…¥å¼Linuxç³»ç»Ÿå’Œè·¨å¹³å°éƒ¨ç½²ã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- **ğŸš€ é«˜æ€§èƒ½C++åç«¯**: åŸºäºTensorRTçš„GPUåŠ é€ŸAIæ¨ç†
- **ğŸ“± FlutteråµŒå…¥å¼å‰ç«¯**: å·¥ä¸šçº§è§¦å±ç•Œé¢ï¼Œé€‚é…LXDEç¯å¢ƒ
- **ğŸ”§ ç¡¬ä»¶åŠ é€Ÿ**: GStreamer + DeepStream æ‘„åƒå¤´å¤„ç†
- **âš¡ æ¨¡å‹ä¼˜åŒ–**: é›†æˆGhostConvã€GSConvã€VoV-GSCSPã€NAMæŠ€æœ¯
- **ğŸŒ è·¨å¹³å°æ”¯æŒ**: x86_64 å’Œ ARM64 (Jetson) åŒæ¶æ„
- **ğŸ“¡ Modbus TCPé€šä¿¡**: ä¸PLCçš„å®æ—¶æ•°æ®äº¤æ¢

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Flutter å‰ç«¯ç•Œé¢                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   å®æ—¶è§†é¢‘æ˜¾ç¤º   â”‚ â”‚   AIæ£€æµ‹ç»“æœ     â”‚ â”‚   ç³»ç»Ÿæ§åˆ¶é¢æ¿   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ FFI/Socket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      C++ åç«¯å¼•æ“                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  TensorRTå¼•æ“   â”‚ â”‚  GStreamerç®¡é“   â”‚ â”‚  ModbusæœåŠ¡å™¨   â”‚  â”‚
â”‚  â”‚  AIæ¨ç†åŠ é€Ÿ     â”‚ â”‚  æ‘„åƒå¤´ç¡¬ä»¶åŠ é€Ÿ   â”‚ â”‚  PLCé€šä¿¡åè®®    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç¡¬ä»¶å±‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     æ‘„åƒå¤´       â”‚ â”‚      PLC       â”‚ â”‚   åˆ‡å‰²è®¾å¤‡       â”‚  â”‚
â”‚  â”‚   V4L2/CSI      â”‚ â”‚  Modbus TCP    â”‚ â”‚   ç”µæœºæ§åˆ¶       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
bamboo-cut-develop/
â”œâ”€â”€ cpp_backend/                    # C++åç«¯æºç 
â”‚   â”œâ”€â”€ src/                       # æºæ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ core/                  # æ ¸å¿ƒç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ vision/                # è§†è§‰å¤„ç†
â”‚   â”‚   â”œâ”€â”€ communication/         # é€šä¿¡æ¨¡å—
â”‚   â”‚   â””â”€â”€ main.cpp              # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ include/                   # å¤´æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ bamboo_cut/           # é¡¹ç›®å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ tests/                     # å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ CMakeLists.txt            # CMakeæ„å»ºé…ç½®
â”œâ”€â”€ flutter_frontend/              # Flutterå‰ç«¯
â”‚   â”œâ”€â”€ lib/                      # Dartæºç 
â”‚   â”‚   â”œâ”€â”€ screens/              # ç•Œé¢é¡µé¢
â”‚   â”‚   â”œâ”€â”€ widgets/              # UIç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ services/             # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ providers/            # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ theme/                # ä¸»é¢˜é…ç½®
â”‚   â”œâ”€â”€ assets/                   # èµ„æºæ–‡ä»¶
â”‚   â””â”€â”€ pubspec.yaml             # Flutteré…ç½®
â”œâ”€â”€ deploy/                       # éƒ¨ç½²ç›¸å…³
â”‚   â”œâ”€â”€ scripts/                  # éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ config/                   # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ packages/                 # æ„å»ºäº§ç‰©
â”œâ”€â”€ docs/                         # æ–‡æ¡£
â””â”€â”€ config/                       # ç³»ç»Ÿé…ç½®
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### C++ åç«¯
- **æ¨ç†å¼•æ“**: TensorRT 8.x, OpenCV DNN (fallback)
- **æ‘„åƒå¤´å¤„ç†**: GStreamer 1.0, DeepStream SDK (Jetson)
- **é€šä¿¡åè®®**: libmodbus, TCP/IP sockets
- **æ„å»ºç³»ç»Ÿ**: CMake 3.16+, GCC 9+
- **æ¨¡å‹ä¼˜åŒ–**: ONNX, TensorRT Engine, FP16/INT8 é‡åŒ–

### Flutter å‰ç«¯
- **UIæ¡†æ¶**: Flutter 3.16+ (Embedded Linux)
- **çŠ¶æ€ç®¡ç†**: Provider + BLoC
- **é€šä¿¡**: FFI (C++ ç»‘å®š), WebSocket
- **å›¾è¡¨**: fl_chart, charts_flutter
- **å¹³å°**: Linux Desktop/Embedded

### éƒ¨ç½²å¹³å°
- **x86_64**: Ubuntu 20.04+, é€šç”¨Linuxå‘è¡Œç‰ˆ
- **ARM64**: NVIDIA Jetson (Nano, Xavier, Orin), æ ‘è“æ´¾4+
- **æ˜¾ç¤º**: LXDE, X11, Waylandæ”¯æŒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

#### Ubuntu/Debianç³»ç»Ÿ
```bash
# å®‰è£…åŸºç¡€ä¾èµ–
sudo apt update
sudo apt install -y build-essential cmake git pkg-config

# å®‰è£…OpenCV
sudo apt install -y libopencv-dev libopencv-contrib-dev

# å®‰è£…GStreamer
sudo apt install -y libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev

# å®‰è£…å…¶ä»–ä¾èµ–
sudo apt install -y libmodbus-dev nlohmann-json3-dev
```

#### Jetsonè®¾å¤‡é¢å¤–é…ç½®
```bash
# å®‰è£…JetPack SDK (åŒ…å«TensorRT, DeepStream)
sudo apt install nvidia-jetpack

# éªŒè¯CUDAå’ŒTensorRT
nvcc --version
dpkg -l | grep TensorRT
```

### 2. å…‹éš†å’Œæ„å»º

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url> bamboo-cut-develop
cd bamboo-cut-develop

# ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬æ„å»º
chmod +x deploy/scripts/build_and_deploy.sh

# é€‰é¡¹1: æœ¬åœ°x86_64æ„å»º
./deploy/scripts/build_and_deploy.sh --install-deps --arch x86_64

# é€‰é¡¹2: Jetson ARM64æ„å»º (åœ¨Jetsonè®¾å¤‡ä¸Š)
./deploy/scripts/build_and_deploy.sh --install-deps --tensorrt --arch aarch64

# é€‰é¡¹3: äº¤å‰ç¼–è¯‘ARM64 (åœ¨x86ä¸»æœºä¸Š)
./deploy/scripts/build_and_deploy.sh --cross-compile --arch aarch64
```

### 3. éƒ¨ç½²å®‰è£…

```bash
# æœ¬åœ°å®‰è£…
./deploy/scripts/build_and_deploy.sh --deploy local

# éƒ¨ç½²åˆ°Jetsonè®¾å¤‡
./deploy/scripts/build_and_deploy.sh --deploy jetson

# éƒ¨ç½²åˆ°è¿œç¨‹è®¾å¤‡
./deploy/scripts/build_and_deploy.sh --deploy remote:192.168.1.100
```

## âš™ï¸ é…ç½®è¯´æ˜

### ç³»ç»Ÿé…ç½® (`config/system_config.yaml`)

```yaml
# ç¡¬ä»¶é…ç½®
hardware:
  camera:
    device_id: "/dev/video0"
    width: 1920
    height: 1080
    framerate: 30

# é€šä¿¡é…ç½®
communication:
  server_ip: "192.168.1.10"
  server_port: 502
  timeout: 5000

# AIé…ç½®
ai:
  model_path: "/opt/bamboo-cut/models/bamboo_detection.onnx"
  confidence_threshold: 0.5
  use_tensorrt: true
```

### æ€§èƒ½é…ç½® (`config/performance_config.yaml`)

```yaml
# æ¨ç†é…ç½®
inference:
  batch_size: 1
  max_threads: 4
  use_fp16: true

# æ‘„åƒå¤´é…ç½®
camera:
  buffer_size: 10
  use_hardware_acceleration: true

# æ¨¡å‹ä¼˜åŒ–
optimization:
  enable_ghostconv: true
  enable_gsconv: true
  enable_vov_gscsp: true
  enable_nam: true
```

## ğŸ® ä½¿ç”¨è¯´æ˜

### 1. å¯åŠ¨ç³»ç»Ÿ

```bash
# æ–¹å¼1: é€šè¿‡systemdæœåŠ¡
sudo systemctl start bamboo-cut
sudo systemctl status bamboo-cut

# æ–¹å¼2: ç›´æ¥è¿è¡Œ
cd /opt/bamboo-cut
./start_bamboo_cut.sh

# æ–¹å¼3: è°ƒè¯•æ¨¡å¼
./bamboo_cut_backend --debug
```

### 2. ç•Œé¢æ“ä½œ

- **ä¸»ç•Œé¢**: å®æ—¶è§†é¢‘æµ + AIæ£€æµ‹ç»“æœ
- **æ§åˆ¶é¢æ¿**: ç³»ç»ŸçŠ¶æ€ã€å‚æ•°è°ƒèŠ‚
- **è®¾ç½®é¡µé¢**: æ‘„åƒå¤´é…ç½®ã€AIå‚æ•°
- **æ—¥å¿—æŸ¥çœ‹**: ç³»ç»Ÿè¿è¡Œæ—¥å¿—

### 3. PLCé€šä¿¡

ç³»ç»Ÿä½œä¸ºModbus TCPæœåŠ¡å™¨ï¼ŒPLCä½œä¸ºå®¢æˆ·ç«¯è¿æ¥ï¼š

```
æœåŠ¡å™¨åœ°å€: 192.168.1.10:502
å¯„å­˜å™¨æ˜ å°„:
- 40001: PLCå¿ƒè·³ (R/W)
- 40002: è§†è§‰ç³»ç»ŸçŠ¶æ€ (R)
- 40101: åæ ‡æ•°é‡ (R)
- 40102+: åæ ‡æ•°æ® (R)
```

## ğŸ”§ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„æ£€æµ‹ç®—æ³•

1. åœ¨ `cpp_backend/src/vision/` ä¸­å®ç°æ–°çš„æ£€æµ‹å™¨ç±»
2. ç»§æ‰¿ `BambooDetector` åŸºç±»
3. å®ç° `detect()` å’Œ `initialize()` æ–¹æ³•
4. åœ¨CMakeLists.txtä¸­æ·»åŠ æºæ–‡ä»¶

### æ‰©å±•Flutterç•Œé¢

1. åœ¨ `flutter_frontend/lib/screens/` ä¸­åˆ›å»ºæ–°é¡µé¢
2. ä½¿ç”¨Provideræ¨¡å¼ç®¡ç†çŠ¶æ€
3. éµå¾ªå·¥ä¸šè®¾è®¡ä¸»é¢˜ (`theme/industrial_theme.dart`)
4. é€‚é…è§¦å±æ“ä½œ (æœ€å°è§¦æ‘¸ç›®æ ‡48dp)

### æ€§èƒ½ä¼˜åŒ–

1. **C++åç«¯ä¼˜åŒ–**:
   - ä½¿ç”¨TensorRT FP16æ¨¡å¼
   - å¯ç”¨GStreamerç¡¬ä»¶è§£ç 
   - è°ƒæ•´çº¿ç¨‹æ± å¤§å°

2. **Flutterå‰ç«¯ä¼˜åŒ–**:
   - å‡å°‘é‡ç»˜åŒºåŸŸ
   - ä½¿ç”¨constæ„é€ å‡½æ•°
   - åˆç†ä½¿ç”¨Provider.selector

## ğŸ“Š æ€§èƒ½åŸºå‡†

### Jetson Xavier NX

| ç»„ä»¶ | æŒ‡æ ‡ | æ€§èƒ½ |
|------|------|------|
| AIæ¨ç† | FPS | 30+ |
| AIæ¨ç† | å»¶è¿Ÿ | <33ms |
| æ‘„åƒå¤´ | FPS | 30 |
| æ‘„åƒå¤´ | å»¶è¿Ÿ | <16ms |
| æ€»ä½“ | CPUä½¿ç”¨ç‡ | <30% |
| æ€»ä½“ | å†…å­˜ä½¿ç”¨ | <1GB |

### x86_64 å·¥æ§æœº

| ç»„ä»¶ | æŒ‡æ ‡ | æ€§èƒ½ |
|------|------|------|
| AIæ¨ç† | FPS | 15+ |
| AIæ¨ç† | å»¶è¿Ÿ | <66ms |
| æ‘„åƒå¤´ | FPS | 30 |
| æ€»ä½“ | CPUä½¿ç”¨ç‡ | <50% |
| æ€»ä½“ | å†…å­˜ä½¿ç”¨ | <2GB |

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **TensorRTæ¨¡å‹åŠ è½½å¤±è´¥**
   ```bash
   # æ£€æŸ¥CUDAå’ŒTensorRTå®‰è£…
   nvcc --version
   dpkg -l | grep tensorrt
   
   # é‡æ–°ç”ŸæˆTensorRTå¼•æ“
   trtexec --onnx=model.onnx --saveEngine=model.trt --fp16
   ```

2. **æ‘„åƒå¤´è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥æ‘„åƒå¤´è®¾å¤‡
   v4l2-ctl --list-devices
   
   # æµ‹è¯•GStreamer pipeline
   gst-launch-1.0 v4l2src device=/dev/video0 ! autovideosink
   ```

3. **Flutterç¼–è¯‘é”™è¯¯**
   ```bash
   # æ¸…ç†ç¼“å­˜
   flutter clean
   flutter pub get
   
   # é‡æ–°æ„å»º
   flutter build linux --release
   ```

### æ—¥å¿—æŸ¥çœ‹

```bash
# ç³»ç»Ÿæ—¥å¿—
journalctl -u bamboo-cut -f

# åº”ç”¨æ—¥å¿—
tail -f /var/log/bamboo-cut/backend.log

# Flutteræ—¥å¿—
tail -f /var/log/bamboo-cut/frontend.log
```

## ğŸ“ˆ ç‰ˆæœ¬å†å²

- **v2.0.0** (å½“å‰ç‰ˆæœ¬)
  - C++/Flutterå…¨æ–°æ¶æ„
  - TensorRT GPUåŠ é€Ÿ
  - å·¥ä¸šçº§åµŒå…¥å¼ç•Œé¢
  - è·¨å¹³å°éƒ¨ç½²æ”¯æŒ

- **v1.x.x** (Pythonç‰ˆæœ¬)
  - Python + GTK4ç•Œé¢
  - OpenCV CPUæ¨ç†
  - åŸºç¡€Modbusé€šä¿¡

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ“ æ”¯æŒ

- ğŸ“§ é‚®ç®±: support@bamboo-cut.com
- ğŸ“± æŠ€æœ¯æ”¯æŒ: +86-xxx-xxxx-xxxx
- ğŸŒ å®˜ç½‘: https://www.bamboo-cut.com
- ğŸ“š æ–‡æ¡£: https://docs.bamboo-cut.com

---

**æ™ºèƒ½åˆ‡ç«¹æœº v2.0 - å·¥ä¸š4.0æ™ºèƒ½åˆ¶é€ è§£å†³æ–¹æ¡ˆ** ğŸ­âœ¨ 