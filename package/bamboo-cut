#!/bin/bash
# 智能切竹机主程序启动脚本

# 设置环境变量
export PYTHONPATH="/opt/bamboo-cut:$PYTHONPATH"
export BAMBOO_CUT_CONFIG_DIR="/etc/bamboo-cut"
export BAMBOO_CUT_LOG_DIR="/opt/bamboo-cut/logs"
export BAMBOO_CUT_DATA_DIR="/opt/bamboo-cut/data"

# 创建日志目录（如果不存在）
mkdir -p "$BAMBOO_CUT_LOG_DIR"

# 检查配置文件
if [ ! -f "/etc/bamboo-cut/system_config.yaml" ]; then
    echo "错误: 配置文件不存在: /etc/bamboo-cut/system_config.yaml"
    echo "请检查安装是否完整"
    exit 1
fi

# 切换到程序目录
cd /opt/bamboo-cut 2>/dev/null || {
    echo "错误: 无法切换到程序目录 /opt/bamboo-cut"
    exit 1
}

# 检查 Python 和依赖
if ! command -v python3 &>/dev/null; then
    echo "错误: Python3 未安装"
    exit 1
fi

# 启动主程序
echo "启动智能切竹机控制系统..."
exec python3 /usr/bin/main.py "$@" 