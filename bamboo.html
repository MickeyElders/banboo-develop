<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIç«¹èŠ‚è¯†åˆ«åˆ‡å‰²ç³»ç»Ÿ v2.1 - Jetson Orin NX é¢„è§ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-main: #0f131a;
            --bg-panel: #161b24;
            --bg-spot: #1f2632;
            --text-primary: #e8ecf3;
            --text-secondary: #9aa4b5;
            --accent: #ff7a3d;
            --success: #4caf50;
            --warning: #f2c14f;
            --error: #f44336;
            --border: #2a3342;
            --jetson: #76b900;
            --modbus: #2196f3;
            --power: #c93dff;
        }

        body {
            font-family: 'Microsoft YaHei', 'Consolas', Arial, sans-serif;
            background: radial-gradient(120% 120% at 20% 20%, #1a222f 0%, #0f131a 40%, #0c1016 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow: hidden;
        }

        #webrtc-panel {
            position: fixed;
            right: 16px;
            bottom: 16px;
            width: 360px;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.45);
            padding: 8px;
            z-index: 50;
        }
        #webrtc-panel h4 {
            margin: 0 0 6px 0;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        #webrtc-panel video {
            width: 100%;
            height: 200px;
            object-fit: contain;
            background: #000;
            border-radius: 8px;
        }
        #webrtc-status {
            font-size: 12px;
            color: var(--error);
        }

        .main-container {
            display: grid;
            grid-template-areas:
                "header header"
                "camera control"
                "footer footer";
            grid-template-columns: 1fr 420px;
            grid-template-rows: 68px 1fr 90px;
            gap: 10px;
            height: 100vh;
            padding: 10px;
        }

        .header-panel {
            grid-area: header;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.35);
        }

        .system-title {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .badge {
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            background: linear-gradient(135deg, #1b88ff, #58c4ff);
            color: #031422;
        }

        .workflow-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .settings-btn {
            padding: 6px 10px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.04);
            color: var(--text-primary);
            cursor: pointer;
            font-weight: 700;
            transition: all 0.25s ease;
        }

        .settings-btn:hover {
            transform: translateY(-1px);
            border-color: var(--accent);
            color: var(--accent);
        }

        .workflow-step {
            padding: 6px 10px;
            border-radius: 12px;
            background: var(--bg-spot);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .workflow-step.active {
            background: rgba(255, 122, 61, 0.2);
            color: var(--text-primary);
            border-color: var(--accent);
            box-shadow: 0 0 12px rgba(255, 122, 61, 0.4);
        }

        .workflow-step.completed {
            background: rgba(76, 175, 80, 0.18);
            color: var(--success);
            border-color: var(--success);
        }

        .heartbeat {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--success);
        }

        .heartbeat-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--success);
            box-shadow: 0 0 12px rgba(76, 175, 80, 0.8);
            animation: beat 1.2s infinite;
        }

        @keyframes beat {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }

        .camera-panel {
            grid-area: camera;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.35);
        }

        .camera-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 16px;
            font-weight: 700;
            color: var(--accent);
        }

        .camera-canvas {
            flex: 1;
            background: linear-gradient(135deg, rgba(33, 45, 63, 0.8), rgba(17, 23, 33, 0.9));
            border: 1px dashed var(--border);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        .camera-canvas video {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #000;
            display: none;
        }

        .camera-placeholder {
            position: absolute;
            inset: 0;
            display: grid;
            place-items: center;
            color: var(--text-secondary);
            font-size: 14px;
            text-align: center;
        }

        .rail-indicator {
            position: absolute;
            bottom: 12px;
            left: 12px;
            right: 12px;
            height: 28px;
            border-radius: 6px;
            border: 1px solid var(--modbus);
            background: rgba(33, 150, 243, 0.12);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--modbus);
            font-size: 12px;
        }

        .cutting-position {
            position: absolute;
            top: 0;
            width: 2px;
            height: 100%;
            background: var(--error);
            transition: left 0.5s ease;
        }

        .coordinate-display {
            background: var(--bg-spot);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 10px;
        }

        .coord-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            font-size: 12px;
        }

        .coord-item {
            padding: 6px 8px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
        }

        .coord-label { color: var(--text-secondary); }

        .coord-value {
            font-size: 16px;
            font-weight: 700;
            color: var(--accent);
        }

        .control-panel {
            grid-area: control;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            overflow-y: auto;
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.35);
        }

        .panel-section {
            background: var(--bg-spot);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 10px;
        }

        .section-title {
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title small { color: var(--text-secondary); font-weight: 400; }

        .registers-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }

        .registers-table th,
        .registers-table td {
            padding: 4px 6px;
            border: 1px solid var(--border);
        }

        .registers-table th {
            background: rgba(33, 150, 243, 0.16);
            color: var(--text-primary);
        }

        .register-addr { color: var(--modbus); font-family: Consolas, monospace; }
        .register-value { color: var(--accent); font-weight: 700; font-family: Consolas, monospace; }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
            font-size: 11px;
        }

        .status-item {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 6px 8px;
            display: flex;
            justify-content: space-between;
        }

        .progress-container { margin-top: 6px; }
        .progress-label { display: flex; justify-content: space-between; font-size: 11px; color: var(--text-secondary); }
        .progress-bar { width: 100%; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; margin-top: 4px; }
        .progress-fill { height: 100%; border-radius: 4px; transition: width 0.35s ease; }
        .progress-cpu { background: var(--jetson); }
        .progress-gpu { background: var(--accent); }
        .progress-memory { background: var(--warning); }
        .progress-temp { background: var(--error); }

        .mode-pill {
            padding: 2px 6px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.04);
            font-size: 11px;
            color: var(--text-secondary);
        }

        .network-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 6px;
        }

        .form-field {
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-size: 11px;
        }

        .form-field label { color: var(--text-secondary); }

        .form-field input,
        .form-field select {
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 6px 8px;
            color: var(--text-primary);
            font-size: 12px;
        }

        .btn-row {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .btn {
            flex: 1;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg-main);
            color: var(--text-primary);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.25s ease;
        }

        .btn:hover { transform: translateY(-1px); border-color: var(--accent); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-accent { background: var(--accent); border-color: var(--accent); color: #0f0f0f; }
        .btn-warning { background: var(--warning); border-color: var(--warning); color: #0f0f0f; }
        .btn-error { background: var(--error); border-color: var(--error); color: #fff; }
        .btn-outline { background: transparent; }

        .footer-panel {
            grid-area: footer;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 -6px 20px rgba(0, 0, 0, 0.35);
        }

        .control-buttons { display: flex; gap: 10px; }
        .emergency-section { display: flex; gap: 10px; }

        .inline-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--border);
            font-size: 12px;
            color: var(--text-secondary);
        }

        .status-good { color: var(--success); }
        .status-bad { color: var(--error); }

        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.55);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 20;
        }

        .modal {
            width: 720px;
            max-width: 90vw;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.45);
            padding: 14px;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 700;
            font-size: 16px;
        }

        .modal-close {
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            border-radius: 8px;
            padding: 6px 10px;
            cursor: pointer;
        }

        .modal-body {
            display: grid;
            gap: 10px;
        }

        .modal-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .modal-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        @media (max-width: 1400px) {
            .main-container { grid-template-columns: 1fr 380px; }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header-panel">
            <div class="system-title">
                AIç«¹èŠ‚è¯†åˆ«åˆ‡å‰²ç³»ç»Ÿ v2.1
                <span class="badge">Jetson Orin NX Â· Modbus TCP</span>
            </div>
            <div class="header-actions">
                <div class="workflow-status">
                    <div class="workflow-step" id="step-1">è¿›æ–™æ£€æµ‹</div>
                    <div class="workflow-step" id="step-2">è§†è§‰è¯†åˆ«</div>
                    <div class="workflow-step" id="step-3">åæ ‡ä¼ è¾“</div>
                    <div class="workflow-step" id="step-4">åˆ‡å‰²å‡†å¤‡</div>
                    <div class="workflow-step" id="step-5">æ‰§è¡Œåˆ‡å‰²</div>
                </div>
                <button class="settings-btn" id="settings-btn">âš™ï¸ è®¾ç½®</button>
                <div class="heartbeat">
                    <div class="heartbeat-dot"></div>
                    <span>å¿ƒè·³ <span id="heartbeat-counter">12345</span></span>
                    <span class="inline-pill">å“åº” <span id="response-time">12ms</span></span>
                </div>
            </div>
        </div>

        <div class="camera-panel">
            <div class="camera-title">
                ğŸ“¹ å®æ—¶æ£€æµ‹ç”»é¢
                <span style="color: var(--text-secondary); font-size: 12px;">1280x720 | YOLOv8 | 0.1mm ç²¾åº¦</span>
            </div>
            <div class="camera-canvas">
                <div class="camera-placeholder">
                    <div>
                        <div>ç«¹ææ£€æµ‹é¢„è§ˆ / RTSP æˆ– GStreamer æµ</div>
                        <small>æ¨ç†æ—¶é—´ <span id="inference-time">15.3ms</span> Â· FPS <span id="detection-fps">28.5</span></small>
                    </div>
                </div>
                <div class="rail-indicator">
                    Xè½´å¯¼è½¨ (0 - 1000.0 mm)
                    <div class="cutting-position" id="cutting-position" style="left: 25%;"></div>
                </div>
            </div>
            <div class="coordinate-display">
                <div class="coord-grid">
                    <div class="coord-item">
                        <div class="coord-label">Xåæ ‡</div>
                        <div class="coord-value" id="x-coordinate">245.8mm</div>
                    </div>
                    <div class="coord-item">
                        <div class="coord-label">åˆ‡å‰²è´¨é‡</div>
                        <div class="coord-value" id="cut-quality" style="color: var(--success);">æ­£å¸¸</div>
                    </div>
                    <div class="coord-item">
                        <div class="coord-label">åˆ€ç‰‡é€‰æ‹©</div>
                        <div class="coord-value" id="blade-selection">åŒåˆ€ç‰‡</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="control-panel">
            <div class="panel-section modbus-section">
                <div class="section-title">ğŸ“Š Modbus å¯„å­˜å™¨çŠ¶æ€ <small>40001+</small></div>
                <table class="registers-table">
                    <thead>
                        <tr>
                            <th>åœ°å€</th>
                            <th>æè¿°</th>
                            <th>å€¼</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td class="register-addr">40001</td><td>ç³»ç»ŸçŠ¶æ€</td><td class="register-value" id="reg-40001">1</td></tr>
                        <tr><td class="register-addr">40002</td><td>PLC å‘½ä»¤</td><td class="register-value" id="reg-40002">2</td></tr>
                        <tr><td class="register-addr">40003</td><td>åæ ‡å°±ç»ª</td><td class="register-value" id="reg-40003">1</td></tr>
                        <tr><td class="register-addr">40004-40005</td><td>X åæ ‡</td><td class="register-value" id="reg-40004">2458</td></tr>
                        <tr><td class="register-addr">40006</td><td>åˆ‡å‰²è´¨é‡</td><td class="register-value" id="reg-40006">0</td></tr>
                        <tr><td class="register-addr">40007-40008</td><td>å¿ƒè·³è®¡æ•°</td><td class="register-value" id="reg-40007">12345</td></tr>
                        <tr><td class="register-addr">40009</td><td>åˆ€ç‰‡ç¼–å·</td><td class="register-value" id="reg-40009">3</td></tr>
                        <tr><td class="register-addr">40010</td><td>å¥åº·çŠ¶æ€</td><td class="register-value" id="reg-40010">0</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="panel-section plc-section">
                <div class="section-title">ğŸ”Œ PLC / ç°åœº IO</div>
                <div class="status-grid">
                    <div class="status-item"><span>PLC è¿æ¥</span><span class="status-good" id="plc-link">åœ¨çº¿</span></div>
                    <div class="status-item"><span>å“åº”</span><span id="plc-response">12ms</span></div>
                    <div class="status-item"><span>æ€¥åœå›è·¯</span><span class="status-good">é—­åˆ</span></div>
                    <div class="status-item"><span>æ°”å‹</span><span>0.62 MPa</span></div>
                </div>
            </div>

            <div class="panel-section jetson-section">
                <div class="section-title">ğŸŸ¢ Jetson Orin NX çŠ¶æ€ <small>æ—  X11ï¼Œé€‚é…æ— å¤´è¿è¡Œ</small></div>
                <div class="progress-container">
                    <div class="progress-label"><span>CPU</span><span id="cpu-usage">45%</span></div>
                    <div class="progress-bar"><div class="progress-fill progress-cpu" id="cpu-progress" style="width: 45%;"></div></div>
                    <div class="progress-label"><span>GPU</span><span id="gpu-usage">32%</span></div>
                    <div class="progress-bar"><div class="progress-fill progress-gpu" id="gpu-progress" style="width: 32%;"></div></div>
                    <div class="progress-label"><span>å†…å­˜</span><span id="memory-usage">2.1GB/8GB</span></div>
                    <div class="progress-bar"><div class="progress-fill progress-memory" id="memory-progress" style="width: 26%;"></div></div>
                    <div class="progress-label"><span>æ¸©åº¦</span><span id="thermal-temp">52Â°C</span></div>
                    <div class="progress-bar"><div class="progress-fill progress-temp" id="temp-progress" style="width: 52%;"></div></div>
                </div>
                <div class="status-grid" style="margin-top: 6px;">
                    <div class="status-item"><span>åŠŸè€—</span><span id="power-draw">8.2W</span></div>
                    <div class="status-item"><span>é£æ‰‡</span><span id="fan-speed">2150 RPM</span></div>
                    <div class="status-item"><span>EMC</span><span id="emc-freq">2133 MHz</span></div>
                    <div class="status-item"><span>è¿è¡Œæ—¶é•¿</span><span id="uptime">2d 3h 15m</span></div>
                    <div class="status-item"><span>æ€§èƒ½æ¨¡å¼</span><span id="perf-mode">15W</span></div>
                    <div class="status-item"><span>X11</span><span class="status-good">å·²ç¦ç”¨</span></div>
                </div>
            </div>

            <div class="panel-section ai-section">
                <div class="section-title">ğŸ§  æ¨¡å‹ & æ£€æµ‹</div>
                <div class="status-grid">
                    <div class="status-item"><span>æ¨¡å‹ç‰ˆæœ¬</span><span>YOLOv8n</span></div>
                    <div class="status-item"><span>æ¨ç†æ—¶é—´</span><span id="model-inference">15.3ms</span></div>
                    <div class="status-item"><span>ç½®ä¿¡é˜ˆå€¼</span><span>0.85</span></div>
                    <div class="status-item"><span>æ£€æµ‹ç²¾åº¦</span><span>94.2%</span></div>
                    <div class="status-item"><span>æ€»æ£€æµ‹æ•°</span><span id="total-detections">15,432</span></div>
                    <div class="status-item"><span>ä»Šæ—¥æ£€æµ‹</span><span id="today-detections">89</span></div>
                </div>
            </div>

            <div class="panel-section communication-section">
                <div class="section-title">ğŸ“ˆ é€šä¿¡ç»Ÿè®¡</div>
                <div class="status-grid">
                    <div class="status-item"><span>è¿æ¥æ—¶é•¿</span><span id="connection-time">2h 15m</span></div>
                    <div class="status-item"><span>æ•°æ®åŒ…</span><span id="data-packets">15,432</span></div>
                    <div class="status-item"><span>é”™è¯¯ç‡</span><span id="error-rate">0.02%</span></div>
                    <div class="status-item"><span>åå</span><span id="throughput">1.2KB/s</span></div>
                    <div class="status-item"><span>Wi-Fi</span><span id="wifi-summary">wlan0 | å·²è¿æ¥</span></div>
                    <div class="status-item"><span>Wi-Fi æ¨¡å¼</span><span id="wifi-mode">DHCP</span></div>
                </div>
            </div>

        </div>

        <div class="footer-panel">
            <div class="control-buttons">
                <button class="btn btn-accent" id="start-btn">å¯åŠ¨ç³»ç»Ÿ</button>
                <button class="btn" id="pause-btn">æš‚åœ</button>
                <button class="btn btn-outline" id="stop-btn">åœæ­¢</button>
            </div>
            <div style="text-align: center; color: var(--text-secondary);">
                <div>å½“å‰å·¥åº: <span id="current-process">è¿›æ–™æ£€æµ‹ä¸­</span></div>
                <div style="font-size: 12px; margin-top: 4px;">ä¸Šæ¬¡åˆ‡å‰² 14:25:33 | ä»Šæ—¥åˆ‡å‰² <span id="daily-cuts">89</span> | æ•ˆç‡ <span id="efficiency">94.2%</span></div>
            </div>
            <div class="emergency-section">
                <button class="btn btn-error" id="emergency-btn">ğŸš¨ ç´§æ€¥åœæœº</button>
                <button class="btn" id="power-btn">â» å…³æœº</button>
            </div>
        </div>
    </div>

    <div class="modal-backdrop" id="settings-modal">
        <div class="modal">
            <div class="modal-header">
                ç³»ç»Ÿè®¾ç½®
                <button class="modal-close" id="modal-close">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="panel-section">
                    <div class="section-title">ğŸ›¡ï¸ ç”µæºæ§åˆ¶ï¼ˆæ— å¤´ï¼‰</div>
                    <div class="modal-actions">
                        <button class="btn btn-warning" id="modal-reboot-btn">é‡å¯ Jetson</button>
                        <button class="btn btn-error" id="modal-shutdown-btn">å®‰å…¨å…³æœº</button>
                        <button class="btn btn-outline" id="modal-restart-service-btn">é‡å¯æ¨ç†/Modbus æœåŠ¡</button>
                    </div>
                </div>
                <div class="panel-section">
                    <div class="section-title">âš¡ æ€§èƒ½æ¨¡å¼</div>
                    <div class="modal-actions">
                        <button class="btn btn-outline perf-btn" data-mode="10W">10W</button>
                        <button class="btn btn-outline perf-btn" data-mode="15W">15W</button>
                        <button class="btn btn-outline perf-btn" data-mode="MAXN">MAXN</button>
                    </div>
                </div>
                <div class="panel-section">
                    <div class="section-title">ğŸ“¶ Wi-Fi é…ç½®</div>
                    <div class="modal-row">
                        <div class="form-field">
                            <label for="wifi-ssid">SSID</label>
                            <input id="wifi-ssid" value="FactoryWiFi">
                        </div>
                        <div class="form-field">
                            <label for="wifi-password">å¯†ç </label>
                            <input id="wifi-password" type="password" value="******">
                        </div>
                        <div class="form-field">
                            <label for="wifi-security">å®‰å…¨</label>
                            <select id="wifi-security">
                                <option value="WPA2-PSK">WPA2-PSK</option>
                                <option value="WPA3">WPA3</option>
                                <option value="OPEN">å¼€æ”¾</option>
                            </select>
                        </div>
                        <div class="form-field">
                            <label for="wifi-mode-select">è·å–åœ°å€</label>
                            <select id="wifi-mode-select">
                                <option value="dhcp">DHCP</option>
                                <option value="static">é™æ€</option>
                            </select>
                        </div>
                        <div class="form-field">
                            <label for="wifi-ip">IP åœ°å€</label>
                            <input id="wifi-ip" value="192.168.1.120">
                        </div>
                        <div class="form-field">
                            <label for="wifi-mask">å­ç½‘æ©ç </label>
                            <input id="wifi-mask" value="255.255.255.0">
                        </div>
                        <div class="form-field">
                            <label for="wifi-gateway">ç½‘å…³</label>
                            <input id="wifi-gateway" value="192.168.1.1">
                        </div>
                        <div class="form-field">
                            <label for="wifi-dns">DNS</label>
                            <input id="wifi-dns" value="223.5.5.5">
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-accent" id="apply-wifi-btn">åº”ç”¨ Wi-Fi</button>
                        <button class="btn" id="check-wifi-btn">è¿é€šæ€§æ£€æµ‹</button>
                        <button class="btn btn-outline" id="restart-wifi-btn">é‡å¯ Wi-Fi æœåŠ¡</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="webrtc-panel">
        <h4>WebRTC é¢„è§ˆ <span id="webrtc-status">æœªè¿æ¥</span></h4>
        <video id="webrtc-video" autoplay playsinline muted></video>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ•°æ®ï¼ˆé¢„è§ˆç”¨ï¼ŒQt ç‰ˆæœ¬è¯·ç»‘å®šçœŸå®æ¥å£ï¼‰
        const systemState = {
            isRunning: false,
            currentStep: 1,
            heartbeat: 12345,
            xCoordinate: 245.8,
            cutQuality: 0,
            bladeSelection: 3,
            plcCommand: 0,
            coordinateReady: 0
        };

        const jetsonData = {
            cpu: { usage: 45, temp: 52 },
            gpu: { usage: 32, temp: 49 },
            memory: { used: 2.1, total: 8 },
            thermal: { temp: 52 },
            fan: { speed: 2150 },
            power: { draw: 8.2 },
            emc: { freq: 2133 },
            uptime: { days: 2, hours: 3, minutes: 15 }
        };

        const aiModelData = {
            inferenceTime: 15.3,
            detectionFps: 28.5,
            totalDetections: 15432,
            todayDetections: 89,
            accuracy: 94.2
        };

        const wifiState = {
            iface: 'wlan0',
            ssid: 'FactoryWiFi',
            password: '******',
            security: 'WPA2-PSK',
            mode: 'dhcp',
            ip: '192.168.1.120',
            mask: '255.255.255.0',
            gateway: '192.168.1.1',
            dns: '223.5.5.5',
            status: 'å·²è¿æ¥',
            rssi: -55
        };

        const performanceState = { mode: '15W' };

        const workflowSteps = [
            { id: 1, name: 'è¿›æ–™æ£€æµ‹', plcCmd: 1 },
            { id: 2, name: 'è§†è§‰è¯†åˆ«', plcCmd: 0 },
            { id: 3, name: 'åæ ‡ä¼ è¾“', plcCmd: 0 },
            { id: 4, name: 'åˆ‡å‰²å‡†å¤‡', plcCmd: 2 },
            { id: 5, name: 'æ‰§è¡Œåˆ‡å‰²', plcCmd: 3 }
        ];

        const statusMaps = {
            cutQuality: ['æ­£å¸¸', 'å¼‚å¸¸'],
            bladeType: ['æœªé€‰', 'åˆ€ç‰‡A', 'åˆ€ç‰‡B', 'åŒåˆ€ç‰‡']
        };

        function updateHeartbeat() {
            systemState.heartbeat += 1;
            document.getElementById('heartbeat-counter').textContent = systemState.heartbeat;
            document.getElementById('reg-40007').textContent = systemState.heartbeat;
        }

        function updateJetsonInfo() {
            jetsonData.cpu.usage = 35 + Math.random() * 30;
            jetsonData.gpu.usage = 20 + Math.random() * 35;
            jetsonData.memory.used = 1.8 + Math.random() * 3.0;
            jetsonData.cpu.temp = 45 + Math.random() * 12;
            jetsonData.gpu.temp = 42 + Math.random() * 10;
            jetsonData.thermal.temp = Math.max(jetsonData.cpu.temp, jetsonData.gpu.temp);
            jetsonData.fan.speed = 1800 + Math.random() * 600;
            jetsonData.power.draw = 7 + Math.random() * 5;

            document.getElementById('cpu-usage').textContent = jetsonData.cpu.usage.toFixed(1) + '%';
            document.getElementById('cpu-progress').style.width = jetsonData.cpu.usage + '%';
            document.getElementById('gpu-usage').textContent = jetsonData.gpu.usage.toFixed(1) + '%';
            document.getElementById('gpu-progress').style.width = jetsonData.gpu.usage + '%';

            const memPercent = (jetsonData.memory.used / jetsonData.memory.total) * 100;
            document.getElementById('memory-usage').textContent = jetsonData.memory.used.toFixed(1) + 'GB/' + jetsonData.memory.total + 'GB';
            document.getElementById('memory-progress').style.width = memPercent + '%';

            document.getElementById('thermal-temp').textContent = jetsonData.thermal.temp.toFixed(0) + 'Â°C';
            document.getElementById('temp-progress').style.width = jetsonData.thermal.temp + '%';
            document.getElementById('fan-speed').textContent = jetsonData.fan.speed.toFixed(0) + ' RPM';
            document.getElementById('power-draw').textContent = jetsonData.power.draw.toFixed(1) + 'W';
            document.getElementById('emc-freq').textContent = jetsonData.emc.freq + ' MHz';
            document.getElementById('uptime').textContent = `${jetsonData.uptime.days}d ${jetsonData.uptime.hours}h ${jetsonData.uptime.minutes}m`;
            document.getElementById('perf-mode').textContent = performanceState.mode;

            aiModelData.inferenceTime = 12 + Math.random() * 8;
            aiModelData.detectionFps = 24 + Math.random() * 8;
            document.getElementById('model-inference').textContent = aiModelData.inferenceTime.toFixed(1) + 'ms';
            document.getElementById('inference-time').textContent = aiModelData.inferenceTime.toFixed(1) + 'ms';
            document.getElementById('detection-fps').textContent = aiModelData.detectionFps.toFixed(1);
        }

        function updateWorkflowStatus(step) {
            for (let i = 1; i <= 5; i++) {
                const el = document.getElementById(`step-${i}`);
                el.classList.remove('active', 'completed');
                if (i < step) el.classList.add('completed');
                if (i === step) el.classList.add('active');
            }
            systemState.currentStep = step;
            document.getElementById('current-process').textContent = workflowSteps[step - 1].name;
        }

        function updateModbusRegisters() {
            document.getElementById('reg-40001').textContent = systemState.isRunning ? 1 : 0;
            document.getElementById('reg-40002').textContent = systemState.plcCommand;
            document.getElementById('reg-40003').textContent = systemState.coordinateReady;
            document.getElementById('reg-40004').textContent = Math.round(systemState.xCoordinate * 10);
            document.getElementById('reg-40006').textContent = systemState.cutQuality;
            document.getElementById('reg-40009').textContent = systemState.bladeSelection;
            document.getElementById('reg-40010').textContent = 0;

            document.getElementById('x-coordinate').textContent = systemState.xCoordinate.toFixed(1) + 'mm';
            document.getElementById('cut-quality').textContent = statusMaps.cutQuality[systemState.cutQuality];
            document.getElementById('blade-selection').textContent = statusMaps.bladeType[systemState.bladeSelection];

            const pos = (systemState.xCoordinate / 1000) * 100;
            document.getElementById('cutting-position').style.left = `${pos}%`;
        }

        function simulateWorkflow() {
            if (!systemState.isRunning) return;
            const step = systemState.currentStep;
            switch (step) {
                case 1:
                    systemState.plcCommand = 1;
                    setTimeout(() => { updateWorkflowStatus(2); simulateWorkflow(); }, 1500);
                    break;
                case 2:
                    systemState.plcCommand = 0;
                    systemState.xCoordinate = 200 + Math.random() * 600;
                    systemState.coordinateReady = 1;
                    setTimeout(() => { updateWorkflowStatus(3); simulateWorkflow(); }, 1200);
                    break;
                case 3:
                    setTimeout(() => { updateWorkflowStatus(4); simulateWorkflow(); }, 800);
                    break;
                case 4:
                    systemState.plcCommand = 2;
                    setTimeout(() => { updateWorkflowStatus(5); simulateWorkflow(); }, 2000);
                    break;
                case 5:
                    systemState.plcCommand = 3;
                    setTimeout(() => {
                        systemState.coordinateReady = 0;
                        aiModelData.todayDetections += 1;
                        aiModelData.totalDetections += 1;
                        document.getElementById('today-detections').textContent = aiModelData.todayDetections;
                        document.getElementById('total-detections').textContent = aiModelData.totalDetections.toLocaleString();
                        updateWorkflowStatus(1);
                        simulateWorkflow();
                    }, 1500);
                    break;
            }
            updateModbusRegisters();
        }

        function updateWifiUI() {
            const disableStatic = wifiState.mode === 'dhcp';
            ['wifi-ip','wifi-mask','wifi-gateway','wifi-dns'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.disabled = disableStatic;
            });
            const summary = `${wifiState.iface} | ${wifiState.status}${wifiState.rssi ? ` | ${wifiState.rssi} dBm` : ''}`;
            document.getElementById('wifi-summary').textContent = summary;
            document.getElementById('wifi-mode').textContent = wifiState.mode.toUpperCase();

            const ssidEl = document.getElementById('wifi-ssid');
            if (ssidEl) {
                ssidEl.value = wifiState.ssid;
                document.getElementById('wifi-password').value = wifiState.password;
                document.getElementById('wifi-security').value = wifiState.security;
                document.getElementById('wifi-mode-select').value = wifiState.mode;
                document.getElementById('wifi-ip').value = wifiState.ip;
                document.getElementById('wifi-mask').value = wifiState.mask;
                document.getElementById('wifi-gateway').value = wifiState.gateway;
                document.getElementById('wifi-dns').value = wifiState.dns;
            }
        }

        function applyWifiConfig() {
            wifiState.ssid = document.getElementById('wifi-ssid').value;
            wifiState.password = document.getElementById('wifi-password').value;
            wifiState.security = document.getElementById('wifi-security').value;
            wifiState.mode = document.getElementById('wifi-mode-select').value;
            wifiState.ip = document.getElementById('wifi-ip').value;
            wifiState.mask = document.getElementById('wifi-mask').value;
            wifiState.gateway = document.getElementById('wifi-gateway').value;
            wifiState.dns = document.getElementById('wifi-dns').value;
            wifiState.status = wifiState.mode === 'dhcp' ? 'è·å–åœ°å€ä¸­' : 'é™æ€é…ç½®å·²åº”ç”¨';
            updateWifiUI();
            alert(`[é¢„è§ˆ] Wi-Fi å·²åº”ç”¨: ${wifiState.ssid} (${wifiState.mode})`);
        }

        function checkWifi() {
            const ok = Math.random() > 0.15;
            wifiState.status = ok ? 'å·²è¿æ¥' : 'æ–­å¼€ / å¾…æ£€æŸ¥';
            wifiState.rssi = ok ? -50 - Math.floor(Math.random() * 15) : null;
            updateWifiUI();
            alert(ok ? '[é¢„è§ˆ] Wi-Fi è¿é€šæ­£å¸¸' : '[é¢„è§ˆ] Wi-Fi æœªè¿æ¥ï¼Œè¯·æ£€æŸ¥å¤©çº¿/å¯†ç /ä¿¡é“');
        }

        function restartWifiService() {
            alert('[é¢„è§ˆ] é‡å¯ Wi-Fi æœåŠ¡ï¼Œè¯·åœ¨å®é™…éƒ¨ç½²ä¸­è°ƒç”¨ network manager/connman/è‡ªå®šä¹‰è„šæœ¬');
        }

        function handlePowerAction(action) {
            const labelMap = {
                reboot: 'é‡å¯ Jetson',
                shutdown: 'å®‰å…¨å…³æœº',
                restartService: 'é‡å¯æ¨ç†/Modbus æœåŠ¡'
            };
            const message = `[é¢„è§ˆ] ${labelMap[action]} å·²è§¦å‘ã€‚å®é™…éƒ¨ç½²è¯·è°ƒç”¨ systemd/DBus/è„šæœ¬ã€‚`;
            alert(message);
        }

        function openSettingsModal() {
            document.getElementById('settings-modal').style.display = 'flex';
        }

        function closeSettingsModal() {
            document.getElementById('settings-modal').style.display = 'none';
        }

        document.getElementById('start-btn').addEventListener('click', () => {
            systemState.isRunning = true;
            systemState.plcCommand = 1;
            document.getElementById('start-btn').disabled = true;
            document.getElementById('start-btn').textContent = 'è¿è¡Œä¸­';
            updateWorkflowStatus(1);
            simulateWorkflow();
        });

        document.getElementById('pause-btn').addEventListener('click', () => {
            if (!systemState.isRunning) return;
            systemState.isRunning = false;
            systemState.plcCommand = 5;
            document.getElementById('start-btn').disabled = false;
            document.getElementById('start-btn').textContent = 'æ¢å¤è¿è¡Œ';
            updateModbusRegisters();
        });

        document.getElementById('stop-btn').addEventListener('click', () => {
            systemState.isRunning = false;
            systemState.plcCommand = 0;
            systemState.coordinateReady = 0;
            document.getElementById('start-btn').disabled = false;
            document.getElementById('start-btn').textContent = 'å¯åŠ¨ç³»ç»Ÿ';
            updateWorkflowStatus(1);
            updateModbusRegisters();
        });

        document.getElementById('emergency-btn').addEventListener('click', () => {
            systemState.isRunning = false;
            systemState.plcCommand = 6;
            ['step-1','step-2','step-3','step-4','step-5'].forEach(id => {
                const el = document.getElementById(id);
                el.classList.remove('active', 'completed');
                el.style.borderColor = 'var(--error)';
                el.style.color = 'var(--error)';
            });
            document.getElementById('current-process').textContent = 'ğŸš¨ ç´§æ€¥åœæœº';
            updateModbusRegisters();
        });

        document.getElementById('power-btn').addEventListener('click', openSettingsModal);
        document.getElementById('settings-btn').addEventListener('click', openSettingsModal);
        document.getElementById('modal-close').addEventListener('click', closeSettingsModal);
        document.getElementById('settings-modal').addEventListener('click', (e) => {
            if (e.target.id === 'settings-modal') closeSettingsModal();
        });

        document.getElementById('modal-shutdown-btn').addEventListener('click', () => handlePowerAction('shutdown'));
        document.getElementById('modal-reboot-btn').addEventListener('click', () => handlePowerAction('reboot'));
        document.getElementById('modal-restart-service-btn').addEventListener('click', () => handlePowerAction('restartService'));

        document.querySelectorAll('.perf-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                performanceState.mode = btn.dataset.mode;
                updateJetsonInfo();
                alert(`[é¢„è§ˆ] æ€§èƒ½æ¨¡å¼åˆ‡æ¢åˆ° ${btn.dataset.mode}ï¼Œå®é™…éƒ¨ç½²è¯·è°ƒç”¨ nvpmodel`);
            });
        });

        document.getElementById('apply-wifi-btn').addEventListener('click', applyWifiConfig);
        document.getElementById('check-wifi-btn').addEventListener('click', checkWifi);
        document.getElementById('restart-wifi-btn').addEventListener('click', restartWifiService);
        document.getElementById('wifi-mode-select').addEventListener('change', (e) => {
            wifiState.mode = e.target.value;
            updateWifiUI();
        });

        updateWifiUI();
        updateModbusRegisters();
        updateWorkflowStatus(1);
        setInterval(updateHeartbeat, 500);
        setInterval(updateJetsonInfo, 2000);
        setInterval(() => {
            const responseTime = Math.floor(Math.random() * 10) + 8;
            document.getElementById('response-time').textContent = responseTime + 'ms';
            document.getElementById('plc-response').textContent = responseTime + 'ms';
        }, 1000);

        // WebRTC over WebSocket (port 8080)
        (function initWebRTC() {
            const statusEl = document.getElementById('webrtc-status');
            const videoEl = document.getElementById('webrtc-video');
            if (!statusEl || !videoEl) return;
            const pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] });
            const wsPort = 9000;
            const ws = new WebSocket(`ws://${location.hostname || '127.0.0.1'}:${wsPort}`);

            const setStatus = (txt, good = false) => {
                statusEl.textContent = txt;
                statusEl.style.color = good ? '#4caf50' : '#f44336';
            };

            pc.ontrack = (e) => {
                if (e.streams && e.streams[0]) {
                    videoEl.srcObject = e.streams[0];
                    videoEl.style.display = 'block';
                }
            };
            pc.onicecandidate = (e) => {
                if (e.candidate && ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({
                        type: 'ice',
                        candidate: e.candidate.candidate,
                        sdpMid: e.candidate.sdpMid,
                        sdpMLineIndex: e.candidate.sdpMLineIndex
                    }));
                }
            };

            ws.onopen = () => setStatus('ä¿¡ä»¤å·²è¿æ¥', true);
            ws.onclose = () => setStatus('æœªè¿æ¥');
            ws.onerror = () => setStatus('ä¿¡ä»¤é”™è¯¯');
            ws.onmessage = async (msg) => {
                try {
                    const data = JSON.parse(msg.data);
                    if (data.type === 'offer' && data.sdp) {
                        await pc.setRemoteDescription({ type: 'offer', sdp: data.sdp });
                        const answer = await pc.createAnswer();
                        await pc.setLocalDescription(answer);
                        ws.send(JSON.stringify({ type: 'answer', sdp: answer.sdp }));
                        setStatus('åå•†ä¸­...', true);
                    } else if (data.type === 'ice' && data.candidate) {
                        await pc.addIceCandidate({
                            candidate: data.candidate,
                            sdpMid: data.sdpMid || null,
                            sdpMLineIndex: data.sdpMLineIndex || 0
                        });
                    }
                } catch (e) {
                    console.error('webrtc signaling error', e);
                    setStatus('ä¿¡ä»¤è§£æå¤±è´¥');
                }
            };
        })();

        console.log('AIç«¹èŠ‚è¯†åˆ«åˆ‡å‰²ç³»ç»Ÿ - æ— å¤´ç‰ˆé¢„è§ˆç•Œé¢å·²åŠ è½½');
    </script>
</body>
</html>
